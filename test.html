<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libsodium.js Example</title>
  </head>
  <body>
    <script src="./scripts/dependencies/peerjs.min.js"></script>
    <script>

      // Function to add listeners to a peer object
      function addListeners(peerObj) {
        // Listen for when the peer connection opens
        peerObj.on('open', (id) => {
          console.log(`Peer ${id} is now open`);
        });

        // Listen for incoming connections
        peerObj.on('connection', (dataConnection) => {
          console.log('Incoming connection detected');

          // Add listeners to the data connection
          addConnListeners(dataConnection);
        });
      }

      // Function to add listeners to a data connection
      function addConnListeners(dataConnection) {
        // Listen for when data is received
        dataConnection.on('data', (data) => {
          console.log(`Data received: ${data}`);
        });

        // Listen for when the connection is opened
        dataConnection.on('open', () => {
          console.log('Data connection is now open');
        });

        // Listen for when the connection is closed
        dataConnection.on('close', () => {
          console.log('Data connection is closed');
        });

        // Listen for errors
        dataConnection.on('error', (err) => {
          console.error('Data connection error:', err);
        });
      }

      // Create two different peers
      const peer1 = new Peer();
      const peer2 = new Peer();

      // Add listeners to both peers
      addListeners(peer1);
      addListeners(peer2);
    </script>
  </body>
</html>
